{"version":3,"sources":["symbol_background.png","index.js"],"names":["module","exports","route_dict","17_Ave","south_cross","north_cross","route_color","mapboxgl","accessToken","Application","props","_this","Object","_Users_saadiqmohiuddin_Documents_Coding_Data_Visualization_calgary_brt_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","_Users_saadiqmohiuddin_Documents_Coding_Data_Visualization_calgary_brt_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_saadiqmohiuddin_Documents_Coding_Data_Visualization_calgary_brt_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","handle","bind","_Users_saadiqmohiuddin_Documents_Coding_Data_Visualization_calgary_brt_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_5__","errordiv","connections","toggle_layer","state","lng","lat","zoom","max_route","stop_name","bus_query","active_route","active_conn","height","width","setState","window","innerHeight","innerWidth","_this2","_this$state","map","Map","container","mapContainer","style","center","maxZoom","minZoom","transformRequest","url","resourceType","startsWith","credentials","on","firstSymbolId","layers","getStyle","i","length","type","id","geojson","String","addSource","data","max_lines","max_stops","red_line","blue_line","addLayer","source","layout","symbol-placement","symbol-spacing","text-rotation-alignment","text-field","text-size","text-font","text-transform","text-letter-spacing","text-offset","paint","text-color","line-color","line-width","line-opacity","line-join","line-cap","features","feature","layer_name","properties","route_name","filter","circle-color","circle-radius","stops","circle-opacity","circle-stroke-width","circle-stroke-color","img","Image","onload","addImage","src","symbol","icon-image","icon-text-fit","icon-text-fit-padding","icon-rotation-alignment","popup","Popup","closeButton","closeOnClick","anchor","offset","forEach","over","leave","click","value","_this3","pad","top","bottom","left","right","setPaintProperty","setFilter","bounds","bbox","geometry","getPaintProperty","fitBounds","padding","output","arguments","undefined","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","placeholder","document","getElementById","text","ReactDOM","render","index","e","preventDefault","target","getAttribute","setLayoutProperty","remove","route","x","push","indexOf","getCanvas","cursor","_this4","_this5","trim","querySelectorAll","element","textContent","classList","replace","fetch","then","response","json","error","getSource","setData","_this6","f","queryRenderedFeatures","point","connection","split","routeConnections","key","className","onClick","setLngLat","coordinates","setDOMContent","addTo","_this7","max_routes","label","line_style","background","borderRadius","marginBottom","ref","el","href","React","Component"],"mappings":"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","file":"static/js/main.381fedf6.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAADX0lEQVRogeXbz2tcVRjG8U+uEjdqhFZBU4TulNKFWhSLJk3VhUsttdC10r/AvW7dCBbbhduikFK7UJCCVZgEglJRid1akCoYjaS1q5JwXLwzdRznzkxm7o/OzBdmce+cOfM83HPuPfc97zuTUlISc3geh3AA+zGPh3B/s80tbOE3/IyruII13ChD1EzBhvfhBF7Hc7hnyH528A0+xXn8Uog6SCkV8VlIKX2WUtpOxbPd7HuxCK2jdnAkpdQowWQejeZ/Vm740ZTSuQoM5nGuqWHX2oeZw8fxkbgp1ckNvCXm+MBku2g7i9NYVr9ZQsOy0HTfoD8a9Ao/gIt4aShp5dPAa/irX8NBDD+ML/DM6LpK5Ue8gj96NepneA5f4enidJXK91jSY9HSaw7Pigf/uJiFp4Tm2bwGvQy/j6NFK6qAo0J7V/KG9HFxBxxnTujioZvhefwkFvnjzBYO4nr7yW5D+rTxN0t4+KDzZOcVXhJ35UniZVxuHXQaXsELVSsqmVW82DpoH9ILJs8s4WmhddBu+O3qtVTGHW+tIf0IfsW9dSkqmW3x9NloXeGTJtcs4e0k/w7pY/VpqYxjxJCew6bhA27jwg72ZDhs8s0SHg9nxuttaFQOZWK9OS0cyMSOwLSwP8NjdauokPnMZLwZDcqDM2mIwPQ4s5u49CRwOxNbltPCrUyEQqaFvzOxGT0t/J7hWt0qKuRaJiKU08LVDN/VraJCrkzb6+HeTGw8rdUspgrWsNVaeFyoU0lFXGCKg3gbuFSfntK5JDz+Zy39Xj1aKuGOt3bDDbEtMWmsCm/4/9vSO5VKqYZ32w86DV8W2TqTwkV82X6i24b4Pqwb/0jIwBvi13GqCkUlc0qHWfIjHss4W6qccjkrJ0elV57WrHh+HSlHU2k0RILa7W5f9ktM24OvjU+wfl2kbWzmNegXxNsUORI/FCiqLNaF1lyzDBa13MCiuNJ3Kyti6m30azhomPYmXsWHw2sqjTNizvbNpGW4Io+7JUH8Jt5UYoJ4i/N4Eh8P8dui+ARP2KVZFFLksVJ4RUM+qymlpVE0F1XGs5hS+jyltFOCyZ1m34tFaC26UOtxvCEKtZ41WqHWtyL3eVmBhVpFG26nvRTvoNh436t7Kd6fYkNgXcmleP8AjUHINmktS24AAAAASUVORK5CYII=\"","\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './styles.css';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport mapboxgl from 'mapbox-gl'\n\nimport { bbox } from '@turf/turf'\nimport symbol from './symbol_background.png';\n\nimport max_lines from './geojson/max_lines.json'\nimport max_stops from './geojson/max_stops.json'\nimport red_line from './geojson/201.json'\nimport blue_line from './geojson/202.json'\n\nlet route_dict = {\n  '17_Ave': \"MAX PURPLE\",\n  \"south_cross\": 'MAX TEAL',\n  'north_cross': 'MAX ORANGE'\n};\n\nlet route_color = {\n  '17_Ave': \"purple\",\n  \"south_cross\": 'teal',\n  'north_cross': 'orange'\n};\n\nmapboxgl.accessToken = 'pk.eyJ1Ijoic2FhZGlxbSIsImEiOiJjamJpMXcxa3AyMG9zMzNyNmdxNDlneGRvIn0.wjlI8r1S_-xxtq2d-W5qPA';\n\nclass Application extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.handle = this.handle.bind(this)\n    this.errordiv = this.errordiv.bind(this)\n    this.connections = this.connections.bind(this)\n    this.toggle_layer = this.toggle_layer.bind(this)\n    this.state = {\n      lng: -114.0708,\n      lat: 51.0486,\n      zoom: 10.7,\n      max_route: '17_ave',\n      stop_name: \"\",\n      connections: [],\n      bus_query: null,\n      active_route: null,\n      active_conn: null,\n      height:props.height,\n      width: props.width\n    };\n  }\n\n  componentWillMount(){\n    this.setState({height: window.innerHeight,width:window.innerWidth});\n  }\n\n  componentDidMount() {\n\n    const {lng, lat, zoom} = this.state;\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      style: 'mapbox://styles/saadiqm/cjbjougmt08z72rsa7me1duoi',\n      center: [lng, lat],\n      zoom: zoom,\n      maxZoom: 13,\n      minZoom: 10,\n      transformRequest: (url, resourceType) => {\n         if(resourceType === 'Source' && url.startsWith('https://04lkhtx0r2')) {\n           return {\n            url: url,\n            credentials: \"omit\"\n          }\n         }\n       }\n    });\n\n    this.map.on('load', () => {\n\n      let layers = this.map.getStyle().layers;\n      // Find the index of the first symbol layer in the map style\n      let firstSymbolId;\n      for (let i = 0; i < layers.length; i++) {\n          if (layers[i].type === 'symbol') {\n              firstSymbolId = layers[i].id;\n              break;\n          }\n      }\n\n\n      let geojson = 'https://xxtg9c00w7.execute-api.us-west-2.amazonaws.com/dev/shapes/'+String(this.state.bus_query)\n\n      this.map.addSource('Bus Route', {\n        type: 'geojson',\n        data: geojson\n      });\n      this.map.addSource('Max Routes', {\n        type: 'geojson',\n        data: max_lines\n      });\n      this.map.addSource('Max Stops', {\n        type: 'geojson',\n        data: max_stops\n      });\n      this.map.addSource('201', {\n        type: 'geojson',\n        data: red_line\n      });\n      this.map.addSource('202', {\n        type: 'geojson',\n        data: blue_line\n      });\n\n      this.map.addLayer({\n          \"id\": \"Red Line\",\n          \"type\": \"symbol\",\n          \"source\": \"201\",\n          \"layout\": {\n            \"symbol-placement\":  \"line\",\n            'symbol-spacing':1000,\n            'text-rotation-alignment':'auto',\n            \"text-field\": '201 Red Line',\n            \"text-size\": 10,\n            \"text-font\": [\"Open Sans Bold\", \"Arial Unicode MS Bold\"],\n            \"text-transform\": \"uppercase\",\n            \"text-letter-spacing\": 0.2,\n            \"text-offset\": [0.8, 0.8]\n          },\n          \"paint\": {\n              \"text-color\": \"white\"\n          }\n      });\n\n      this.map.addLayer({\n          \"id\": \"Blue Line\",\n          \"type\": \"symbol\",\n          \"source\": \"202\",\n          \"layout\": {\n            \"symbol-placement\":  \"line\",\n            'symbol-spacing':1000,\n            'text-rotation-alignment':'auto',\n            \"text-field\": '202 Blue Line',\n            \"text-size\": 10,\n            \"text-font\": [\"Open Sans Bold\", \"Arial Unicode MS Bold\"],\n            \"text-transform\": \"uppercase\",\n            \"text-letter-spacing\": 0.2,\n            \"text-offset\": [0.8, 0.8]\n          },\n          \"paint\": {\n              \"text-color\": \"white\"\n          }\n      });\n\n      this.map.addLayer({\n          \"id\": \"201\",\n          \"type\": \"line\",\n          \"source\": '201',\n          \"paint\": {\n              \"line-color\": \"red\",\n              \"line-width\": 4,\n              \"line-opacity\": 0.2\n          },\n          \"layout\": {\n              \"line-join\": \"round\",\n              \"line-cap\": \"round\"\n          },\n      }, firstSymbolId);\n\n      this.map.addLayer({\n          \"id\": \"202\",\n          \"type\": \"line\",\n          \"source\": '202',\n          \"paint\": {\n              \"line-color\": \"#008afc\",\n              \"line-width\": 4,\n              \"line-opacity\": 0.2,\n          },\n          \"layout\": {\n              \"line-join\": \"round\",\n              \"line-cap\": \"round\"\n          },\n      }, firstSymbolId);\n\n      max_lines.features.map((feature)=>{\n        let layer_name = feature.properties.route_name\n        return this.map.addLayer({\n            \"id\": layer_name,\n            \"type\": \"line\",\n            \"source\": 'Max Routes',\n            \"paint\": {\n                \"line-color\": [\n                  'match',\n                  ['get', 'route_name'],\n                  'south_cross', 'teal',\n                  'north_cross', 'orange',\n                  '17_Ave', 'purple',\n                  'blue'\n                ],\n                \"line-width\": 5,\n                \"line-opacity\": 0.6\n            },\n            \"layout\": {\n                \"line-join\": \"round\",\n                \"line-cap\": \"round\"\n            },\n            \"filter\": [\"==\", \"route_name\", layer_name]\n        }, firstSymbolId);\n\n      },'road_label_large');\n\n      this.map.addLayer({\n          \"id\": \"Bus Route\",\n          \"type\": \"line\",\n          \"source\": 'Bus Route',\n          \"paint\": {\n              \"line-color\": \"red\",\n              \"line-width\": 4,\n              \"line-opacity\": 0.9\n          },\n          \"layout\": {\n              \"line-join\": \"round\",\n              \"line-cap\": \"round\"\n          },\n      }, firstSymbolId);\n\n      this.map.addLayer({\n          \"id\": \"Max Stops\",\n          \"type\": \"circle\",\n          \"source\": 'Max Stops',\n          \"paint\": {\n              \"circle-color\": \"white\",\n              'circle-radius':{\n                  stops: [[8, 4], [11, 6], [16, 20]]\n              },\n              \"circle-opacity\": 0.7\n          },\n          \"filter\": [\"==\", \"route_name\", '']\n      });\n\n      this.map.addLayer({\n          \"id\": \"Selected Stop\",\n          \"type\": \"circle\",\n          \"source\": 'Max Stops',\n          \"paint\": {\n              \"circle-color\": \"white\",\n              'circle-radius':{\n                stops: [[8, 4], [11, 6], [16, 20]]\n              },\n              \"circle-opacity\": 0.9,\n              \"circle-stroke-width\": 4,\n              \"circle-stroke-color\": '#a5a5a5'\n          },\n          \"filter\": [\"==\", \"stop_name\", '']\n      });\n\n\n      let img = new Image(27,27)\n      img.onload = ()=> this.map.addImage('bus', img)\n      img.src = symbol\n\n      this.map.addLayer({\n          \"id\": \"symbols\",\n          \"type\": \"symbol\",\n          \"source\": \"Bus Route\",\n          \"layout\": {\n            \"icon-image\": \"bus\",\n            \"icon-text-fit\":'none',\n            \"icon-text-fit-padding\":[3,3,3,3],\n            \"symbol-placement\":  \"line\",\n            'symbol-spacing':1000,\n            'icon-rotation-alignment': 'viewport',\n            'text-rotation-alignment':'viewport',\n            \"text-field\": String(this.state.bus_query), // part 2 of this is how to do it\n            \"text-size\": 12,\n            \"text-font\": [\"Open Sans Bold\", \"Arial Unicode MS Bold\"],\n            \"text-transform\": \"uppercase\",\n            \"text-letter-spacing\": 0.05,\n            \"text-offset\": [0, 0]\n          },\n          \"paint\": {\n              \"text-color\": \"red\"\n          }\n      });\n\n    });\n\n\n\n    this.popup = new mapboxgl.Popup({\n            closeButton: false,\n            closeOnClick: true,\n            anchor: 'bottom-left',\n            offset: [10,-15]\n    });\n\n    this.map.on('mouseover',\"Max Stops\",this.stops.bind(this));\n\n    max_lines.features.forEach((feature)=>{\n      let layer_name = feature.properties.route_name\n      this.map.on('mouseenter',layer_name, this.over.bind(this));\n      this.map.on('mouseleave', layer_name, this.leave.bind(this));\n      this.map.on('click', layer_name, this.click.bind(this));\n    });\n\n  }\n\n  toggle_layer(value){\n\n    let pad = {}\n    if (this.state.width<500){\n      pad ={top:this.state.height*0.4, bottom: 15, left:15, right:15};\n    } else {\n      pad ={top:this.state.height*0.1, bottom:this.state.height*0.1, left:this.state.width*0.3, right:this.state.height*0.1};\n    }\n\n    max_lines.features.forEach((feature)=>{\n      let layer_name = feature.properties.route_name\n\n      if(layer_name===value){\n        this.map.setPaintProperty(value, 'line-opacity', 1);\n        this.map.setFilter('Max Stops',['==', 'route_name', value])\n\n        let bounds= bbox(feature.geometry);\n\n        if(this.map.getPaintProperty(value, 'line-opacity') === 1){\n          this.map.fitBounds(bounds, {\n            padding: {top: pad.top, bottom:pad.bottom, left: pad.left, right: pad.right}\n          });\n        }\n      }else{\n        this.map.setPaintProperty(layer_name, 'line-opacity', 0.4);\n      }\n\n    });\n  }\n\n  errordiv(output=<div></div>){\n    const placeholder = document.getElementById(\"error\");\n    let text = output\n    ReactDOM.render(text, placeholder);\n  }\n\n  handle(index, e){\n    e.preventDefault();\n\n    this.setState({ active_route: index, active_conn:null,bus_query: null, connections:[], stop_name:'' });\n\n    let value = e.target.getAttribute('value')\n\n    this.toggle_layer(value)\n    this.map.setLayoutProperty('Bus Route', 'visibility', 'none');\n    this.map.setLayoutProperty('symbols', 'visibility', 'none');\n    this.popup.remove()\n\n    this.errordiv()\n\n  }\n\n  click(e){\n    e.preventDefault();\n    let value = e.features[0].properties.route_name\n\n    let route = []\n    max_lines.features.forEach(x => route.push(x.properties.route_name))\n    let index = route.indexOf(value)\n\n    this.setState({ active_route: index, active_conn:null, bus_query: null});\n    this.toggle_layer(value)\n    this.map.setLayoutProperty('Bus Route', 'visibility', 'none');\n    this.map.setLayoutProperty('symbols', 'visibility', 'none');\n\n    this.errordiv()\n\n  }\n\n  over(e){\n    let route = e.features[0].properties.route_name\n    this.map.getCanvas().style.cursor = 'pointer';\n    if(this.map.getPaintProperty(route, 'line-opacity') !== 1){\n      this.map.setPaintProperty(route, 'line-opacity', 0.8);\n    }\n  }\n\n  leave(e){\n    this.map.getCanvas().style.cursor = '';\n    max_lines.features.forEach((feature)=>{\n      let route = feature.properties.route_name\n      if(this.map.getPaintProperty(route, 'line-opacity') !== 1){\n        this.map.setPaintProperty(route, 'line-opacity', 0.4);\n      }\n    });\n  }\n\n  connections(x, e){\n    e.preventDefault();\n\n    let pad = {}\n    if (this.state.width<500){\n      pad ={top:this.state.height*0.4, bottom: 15, left:15, right:15};\n    } else {\n      pad ={top:this.state.height*0.1, bottom:this.state.height*0.1, left:this.state.width*0.3, right:this.state.height*0.1};\n    }\n\n    this.setState({bus_query: x.trim()}, () => { //update selected bus route\n\n      let demoId = document.querySelectorAll('#bus_node');\n      demoId.forEach(element => {\n        if(this.state.bus_query===element.textContent.trim()){\n          element.classList.replace('bus_select2','bus_list2')\n        }else{\n          element.classList.replace('bus_list2','bus_select2')\n        }\n      });\n\n      let geojson = 'https://xxtg9c00w7.execute-api.us-west-2.amazonaws.com/dev/shapes/'+this.state.bus_query\n\n      this.map.setLayoutProperty('symbols', 'text-field', String(this.state.bus_query))\n\n      fetch(geojson)\n        .then(response => {\n            return response.json();\n        }).then(data => {\n\n          try{\n            let bounds= bbox(data); //find bounding box using Turf\n            this.map.fitBounds(bounds, {\n              padding: {top: pad.top, bottom:pad.bottom, left: pad.left, right: pad.right}\n            });\n            this.errordiv()\n          }\n          catch(error) {\n            this.errordiv(<h3>Cannot show this bus route</h3>)\n          }\n        });\n\n      this.map.getSource('Bus Route').setData(geojson);\n      this.map.setLayoutProperty('Bus Route', 'visibility', 'visible');\n      this.map.setLayoutProperty('symbols', 'visibility', 'visible');\n\n    })\n\n  }\n\n  stops(e){\n\n    let f = this.map.queryRenderedFeatures(e.point, { layers: ['Max Stops'] });\n    this.setState({ active_conn: null });\n\n    if(f.length > 0){\n      this.setState({\n        stop_name:f[0].properties.stop_name,\n        connections:f[0].properties.connection.split(',')\n      });\n\n      this.map.setFilter('Selected Stop',['==', 'stop_name', this.state.stop_name])\n\n      let routeConnections = this.state.connections.map((x, index) => {\n        let output\n        if(x===\"null\"){\n          output = <span value={x} key={x}>No Connections</span>\n        }else{\n\n          output = <span id=\"bus_node\" className='bus_select2' onClick={this.connections.bind(this, x)} value={x} key={x}>{x}</span>\n\n        }\n        return output\n      });\n\n      let text = <div><h2>{this.state.stop_name}</h2>{routeConnections}</div>\n\n      const placeholder = document.createElement('div');\n      ReactDOM.render(text, placeholder);\n\n      this.popup.setLngLat(f[0].geometry.coordinates).setDOMContent(placeholder).addTo(this.map);\n    }\n\n  }\n\n  render() {\n\n    let max_routes = max_lines.features.map((x, index) => {\n\n      let value = x.properties.route_name;\n      let label = route_dict[x.properties.route_name]\n\n      const line_style = {height:'3px', background:route_color[x.properties.route_name],  borderRadius:'8px'}\n\n      return  <li style={{marginBottom: '10px'}} className={this.state.active_route===index ? 'route_list': 'route_select'} onClick={this.handle.bind(this, index)} value ={value} key={value}>{label}  <hr style={line_style} /></li>\n\n    });\n\n\n    return (\n      <div>\n        <div ref={el => this.mapContainer = el} className=\"absolute top right left bottom\" />\n\n        <div className=\"border_box\">\n\n          <h1>CALGARY TRANSIT BRT SYSTEM MAP</h1>\n\n          <div>\n            <ul>\n              {max_routes}\n            </ul>\n          </div>\n\n          <div id=\"error\"></div>\n\n          <div className='byline'>\n            <h4>&copy;2018 Saadiq Mohiuddin <a href=\"https://www.twitter.com/saadiqmohiuddin\">@saadiqmohiuddin</a></h4>\n          </div>\n\n\n        </div>\n      </div>\n\n    );\n  }\n}\nReactDOM.render(<Application />, document.getElementById('root'));\n"],"sourceRoot":""}